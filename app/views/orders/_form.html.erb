<%= form_for order, as: :order, url: url, html: { class: 'form-horizontal', role: 'form' } do |f| %>
  <% if order.errors.size > 0 %>
    <ul class="alert alert-danger">
      <% order.errors.full_messages.each do |message| %>
        <li><%= message %></li>
      <% end %>
    </ul>
  <% end %>

  <div class="form-group">
    <div class="col-sm-10">
      <%= f.label :flavor_id %>
      <%= f.select :flavor_id,
        Flavor.all.map { |flavor| [flavor.name.capitalize, flavor.id] }
      %>
    </div>
  </div>

  <div class="form-group">
    <div class="col-sm-10">
      <%= f.label :serving_size_id, 'Serving Size' %>
      <%= f.select :serving_size_id,
        ServingSize.all.map { |serving_size| [serving_size.name.capitalize, serving_size.id] }
      %>
    </div>
  </div>

  <div class="form-group">
    <div class="col-sm-10">
      <%= f.label :scoops %>
      <%= f.select :scoops, options_for_select(1..3, f.object.scoops) %>
    </div>
  </div>

  <fieldset>
    <legend>Toppings</legend>
    <div class="form-group">
      <div class="col-sm-10">
        <ul class="checkbox">
          <% Topping.all.each do |topping| %>
            <li>
              <%= label_tag "topping_ids_#{topping.name.parameterize.underscore}" do %>
                <%= topping.name.titleize %>
                <%= check_box_tag 'order[topping_ids][]',
                  topping.id,
                  order.topping_ids.include?(topping.id),
                  id: "topping_ids_#{topping.name.parameterize.underscore}" %>
              <% end %>
            </li>
          <% end %>
        </ul>
      </div>
    </div>
  </fieldset>

  <% if order.persisted? %>
    <fieldset>
      <legend>Memes</legend>
      <div class="form-group">
        <% order.memes.each_with_index do |meme, index| %>
          <div class="col-sm-10">
            <% if meme.id %>
              <%= hidden_field_tag "order[memes][][id]", meme.id %>
            <% end %>

            <%= label_tag "order[memes][][name]", 'Name' %>
            <%= text_field_tag "order[memes][][name]", meme.name %>
            <%= label_tag "order[memes][][rating]", 'Rating' %>
            <%= select_tag "order[memes][][rating]", options_for_select(10.downto(1), meme.rating), include_blank: true %>

            <% if meme.id %>
              <%= label_tag "memes_destroy_#{index}" do %>
                <%= check_box_tag "order[memes][][_destroy]", 1, false, id: "memes_destroy_#{index}" %>
                Delete
              <% end %>
            <% end %>
          </div>
        <% end %>
      </div>
    </fieldset>
  <% end %>

  <%= f.submit 'Make It So (Delicious)', class: 'btn btn-primary' %>
  <%= link_to 'Cancel', orders_path, class: 'btn btn-primary' %>
<% end %>
